# piscine-blockchain

## Project Setup

### Configuration Files
The project uses several configuration files to set up the Bitcoin Core environment:

1. **Docker Configuration**
   - File: [`Dockerfile`](./Dockerfile)
   - Purpose: Sets up a Docker container with Bitcoin Core 24.0.1
   - Key features:
     - Ubuntu 22.04 base image
     - Bitcoin Core installation
     - User and directory setup
     - RPC port exposure (18443)

2. **Bitcoin Configuration**
   - File: [`bitcoin.conf`](./bitcoin.conf)
   - Purpose: Configures Bitcoin Core for regtest network
   - Key settings:
     - RPC authentication (user: leeloo, password: multipass)
     - Regtest network mode
     - Transaction indexing enabled
     - Debug mode active

3. **Node.js Configuration**
   - File: [`package.json`](./package.json)
   - Purpose: Manages Node.js dependencies and project metadata
   - Dependencies:
     - node-fetch: ^3.3.2

## Progress Tracking

### Chapter 1: TRANSACTIONS
This chapter focuses on understanding and implementing Bitcoin transactions in a test environment.

#### Completed Exercises
1. **SEND-TRANSACTION**
   - File: [`send-transaction.js`](./send-transaction.js)
   - Status: âœ… Completed
   - Description: Created and executed a Bitcoin transaction on the regtest network.
   - Key Concepts:
     - Setting up Bitcoin Core in regtest mode
     - Creating wallets and addresses
     - Generating blocks for mining rewards
     - Sending transactions between addresses

2. **RETRIEVE-BLOCK-DATE**
   - File: [`retrieve-block-date.js`](./retrieve-block-date.js)
   - Status: âœ… Completed
   - Description: Implemented a function to retrieve block timestamps using both block height and block hash inputs.
   - Key Concepts:
     - Block height vs block hash
     - RPC communication with Bitcoin Core
     - Error handling in blockchain operations

3. **RETRIEVE-TRANSACTION-VALUE**
   - File: [`retrieve-transaction-value.js`](./retrieve-transaction-value.js)
   - Status: âœ… Completed
   - Description: Implemented a function to calculate the total value transferred in a Bitcoin transaction.
   - Key Concepts:
     - Transaction structure and outputs
     - Satoshi to Bitcoin conversion (1 satoshi = 10^-8 bitcoin)
     - RPC methods: getrawtransaction and decoderawtransaction
     - Summing transaction outputs

### Upcoming Chapters
1. **Chapter 2: CRYPTO**
   - Status: ðŸ”„ Coming Soon
   - Description: Understanding cryptographic foundations of Bitcoin
   - Expected Topics:
     - Hash functions
     - Digital signatures
     - Public key cryptography

#### Exercise Details

##### SEND-TRANSACTION
The first exercise focused on setting up a local Bitcoin test environment and creating a transaction. Here's the step-by-step process:

###### Setup Instructions
1. **Install Bitcoin Core**
   - Two options available:
     - Use cryptotux (preconfigured VM)
     - Manual installation from Bitcoin Core GitHub
   - Version used: 24.0.1

2. **Launch Bitcoin Core**
   - Command: `bitcoind -chain=regtest -daemon -fallbackfee=0.00000003`
   - Network: regtest (local test network)

3. **Create Wallet and Addresses**
   - Create wallet: `bitcoin-cli -regtest createwallet "testwallet"`
   - Generate addresses: `bitcoin-cli -regtest getnewaddress`

4. **Generate Initial Blocks**
   - Generate 101 blocks to get spendable bitcoins
   - Command: `bitcoin-cli -regtest generatetoaddress 101 <address>`

5. **Create Transaction**
   - Send 2 BTC to second address
   - Command: `bitcoin-cli -regtest sendtoaddress <address> 2`

###### Implementation
The `send-transaction.js` file contains:
```javascript
exports.txid = "7328df147ce017b8cd6b54ccdb22280f701095d8dbe7fe117391f405f229915e";
```
- Transaction ID: `7328df147ce017b8cd6b54ccdb22280f701095d8dbe7fe117391f405f229915e`
- Status: Completed
- Purpose: Demonstrates successful transaction creation and broadcasting

##### RETRIEVE-BLOCK-DATE
The `retrieve-block-date.js` file contains a function that retrieves the timestamp of a Bitcoin block. Here's how it works:

###### Function Overview
```javascript
async function retrieveBlockDate(blockIdentifier)
```
This function can accept either:
- A block height (number): e.g., `0` for the genesis block
- A block hash (string): e.g., `"6232d3621044b3fbcbad5a1f0e882a7002ebe5ffed56e217f8c1875f6f70426a"`

###### Blockchain Context
1. **Block Height vs Block Hash**
   - Block Height: A sequential number representing a block's position in the blockchain (0 for genesis block)
   - Block Hash: A unique identifier for a block, generated by hashing the block's contents

2. **RPC Communication**
   - The function communicates with a Bitcoin Core node using JSON-RPC
   - It uses two main RPC calls:
     - `getblockhash`: Converts a block height to its corresponding block hash
     - `getblock`: Retrieves detailed information about a block, including its timestamp

3. **Authentication**
   - Uses Basic Authentication with username 'leeloo' and password 'multipass'
   - These credentials are used to authenticate with the Bitcoin Core node

###### How It Works
1. If a block height is provided:
   - First calls `getblockhash` to get the block's hash
   - Then uses that hash to get the block's information
2. If a block hash is provided:
   - Directly uses the hash to get the block's information
3. Returns the block's timestamp in Unix time (seconds since January 1, 1970)

###### Error Handling
- Handles both HTTP errors (connection issues) and RPC errors (invalid block height/hash)
- Returns `null` if any error occurs during the process

###### Example Usage
```javascript
// Using block height
const timestamp1 = await retrieveBlockDate(0); // Genesis block

// Using block hash
const timestamp2 = await retrieveBlockDate("6232d3621044b3fbcbad5a1f0e882a7002ebe5ffed56e217f8c1875f6f70426a");
```

##### RETRIEVE-TRANSACTION-VALUE
The `retrieve-transaction-value.js` file contains a function that calculates the total value transferred in a Bitcoin transaction. Here's how it works:

###### Function Overview
```javascript
async function retrieveTxValue(txHash)
```
This function:
- Takes a transaction hash as input
- Returns the total value transferred in bitcoins
- Handles multiple outputs by summing their values

###### Implementation Details
1. **RPC Communication**
   - Uses the same RPC interface as other exercises
   - Makes two RPC calls:
     - `getrawtransaction`: Gets the raw transaction data
     - `decoderawtransaction`: Decodes the transaction details

2. **Value Calculation**
   - Extracts all outputs (vout) from the transaction
   - Converts each output's value from BTC to satoshis
   - Sums up all output values
   - Converts the total back to BTC

3. **Error Handling**
   - Handles both HTTP and RPC errors
   - Returns null if any error occurs
   - Provides detailed error messages

###### Example Usage
```javascript
const { retrieveTxValue } = require('./retrieve-transaction-value.js');

// Example transaction hash
const txHash = 'd030023d96b9170af9ec2fe5d9b62a5eacbcbf144c68f3f45d68bca72d1d3649';

// Get the total value transferred
const value = await retrieveTxValue(txHash);
console.log(value); // Expected: 50 (for the example transaction)
```

## Resources
- [Bitcoin Core Node](https://bitcoin.org)
- [Bitcoin for Developers Introduction](https://developer.bitcoin.org)
- [Cryptotux](https://cryptotux.org) - Linux image with developer tools

## Next Steps
- [ ] Complete Chapter 1: TRANSACTIONS exercises
- [ ] Prepare for Chapter 2: CRYPTO
- [ ] Update documentation for new chapters
- [ ] Add troubleshooting section for common issues

